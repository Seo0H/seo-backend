name: Docker CD Pipeline

on:
  workflow_run:
    workflows: ["Docker Image CI"]
    types:
        - completed

jobs:

  build:
    runs-on: self-hosted
    steps:
      - name: ✅ Login Dockerhub
        env:
          DOCKER_USERNAME: ${{secrets.DOCKERHUB_USERNAME}}
          DOCKER_PASSWORD: ${{secrets.DOCKERHUB_PASSWORD}}
        run: docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD

      - name: ⏬ Pull Docker image
        run: sudo docker pull seoh99/seo-backend:latest

      - name: 🗑️ Delete Old docker container
        run: sudo docker rm -f seo-backend || true

      - name: 👟 Run Docker Container
        run: sudo docker run -d -p 80:8080 --name seo-backend-container seoh99/seo-backend